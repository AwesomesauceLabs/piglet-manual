<!doctype html>

<html lang="en">

    <head>
        <meta charset="utf-8">
        <title>Manual: Piglet glTF Importer for Unity</title>
        <meta name="description" content="Manual: Piglet glTF Importer for Unity">
        <meta name="author" content="Awesomesauce Labs">
        <style>

         table {
             border-collapse: collapse;
         }

         table, th, tr {
             border-top: 1px solid black;
             border-bottom: 1px solid black;
         }
         
         table caption {
             padding: 10px;
             font-style: italic;
             font-size: 110%;
         }

         th, td {
             padding: 5px 10px 5px 10px;
             text-align: left;
             vertical-align: top;
         }

         th {
             background-color: #dededf;
         }

         figcaption {
             font-style: italic;
         }
         
        </style>
    </head>

    <body>

        <h1>Manual: Piglet glTF Importer for Unity</h1>

        <ul>
            <li>Online documentation: <a href="https://awesomesaucelabs.github.io/piglet-manual/">https://awesomesaucelabs.github.io/piglet-manual/</a></li>
            <li>Support e-mail: <a href="mailto:awesomesaucelabs@gmail.com">awesomesaucelabs@gmail.com</a></li>
        </ul>

        <h2>Table of Contents</h2>

        <ul>
            <li><a href="#introduction">Introduction</a></li>
            <li><a href="#features">Features</a></li>
            <li><a href="#caveats">Caveats</a></li>
            <li><a href="#setup">Setup</a></li>
            <li><a href="#editor-imports">Editor Imports</a></li>
            <ul>
                <li><a href="#piglet-options-window">Piglet Options Window</a></li>
            </ul>
            <li><a href="#runtime-imports">Runtime Imports</a></li>
            <ul>
                <li><a href="#runtime-import-tutorial">Runtime Import Tutorial</a></li>
                <li><a href="#runtime-import-api">Runtime Import API</a></li>
            </ul>
            <li><a href="#piglet-viewer">Sample Application: PigletViewer</a></li>
           <li><a href="#footnotes">Footnotes</a></li>
        </ul>

        <h2 id="introduction">Introduction</h2>

        <p>Piglet is a Unity asset that allows you to import 3D models from glTF files, both in the Editor and at runtime. This provides Unity developers access to a large collection of free textures, materials, and models from sites like <a href="https://sketchfab.com/">Sketchfab</a> and <a href="https://poly.google.com">Google Poly</a><sup><a href="#footnote1">1</a></sup>.</p>

        <p>Visit the <a href="https://awesomesaucelabs.github.io/piglet-webgl-demo/">Web Demo</a><sup><a href="#footnote2">2</a></sup> to try Piglet before you buy it.</p>

        <h2 id="features">Features</h2>
        
        <ul>
            <li>import glTF models in the Editor or at runtime</li>
            <li>import glTF models from <code>.gltf</code>, <code>.glb</code>, or <code>.zip</code> files, using file paths or HTTP URLs
            <li>extract textures and materials from glTF models, for use with your own 3D models</li>
            <li>tested with glTF models from <a href="https://sketchfab.com/">Sketchfab</a>, <a href="https://poly.google.com">Google Poly</a><sup><a href="#footnote1">1</a></sup>, and <a href="https://www.blender.org/">Blender</a></li>
            <li>supported platforms: Windows, Android, WebGL (Unity 2018.4 or newer)</li>
            <li>full source code provided</li>
        </ul>

        <h2 id="caveats">Caveats</h2>

        <ul>
            <li><b>Piglet does not import animations (yet!)</b>. However, glTF models containing animation data can still be imported as static models. In addition, any skinning data or blendshape data (a.k.a. "morph targets") will be correctly imported alongside the model(s).</li>
            <li><b>Runtime imports may stall the main Unity thread</b>. While I have attempted to minimize interruptions to the main Unity thread during runtime imports, I cannot provide any hard guarantees about this yet. Unity requires certain operations (e.g. mesh creation) to be performed on the main Unity thread, and so it is possible for runtime imports of large/complex models to cause "hiccups" during game execution.</li>
        </ul>

        <h2 id="setup">Setup</h2>

        <p>To set up Piglet in your project, purchase and install Piglet from the Unity Asset Store page. Piglet works with Unity 2018.4 or later, and does not require installation of any third-party dependencies. If you wish to try your own glTF models with Piglet prior to purchasing the asset, please see the <a href="https://awesomesaucelabs.github.io/piglet-webgl-demo/">Piglet WebGL Demo</a>.</p>

        <p>Piglet bundles the following libraries:</p>

        <table>
            <tr>
                <th>Library</th>
                <th>Author</th>
                <th>License</th>
                <th>Path</th>
            </tr> 
            <tr>
                <td><a href="https://www.newtonsoft.com/json">Json.NET</a></td>
                <td><a href="https://www.newtonsoft.com">Newtonsoft</a></td>
                <td>MIT License</td>
                <td><code>Assets/Piglet/Dependencies/Json.NET</code></td>
            </tr>
            <tr>
                <td><a href="https://github.com/icsharpcode/SharpZipLib">SharpZipLib</a></td>
                <td><a href="https://github.com/icsharpcode">icsharpcode@github</a></td>
                <td>MIT License</td>
                <td><code>Assets/Piglet/Dependencies/SharpZipLib</code></td>
            </tr>
            <tr>
                <td><a href="https://github.com/sketchfab/UnityGLTF">UnityGLTF</a></td>
                <td><a href="https://www.khronos.org/">Khronos</a>/<a href="https://sketchfab.com">Sketchfab</a></td>
                <td>MIT License</td>
                <td><code>Assets/Piglet/Dependencies/UnityGLTF</code></td>
            </tr>
        </table>

        <p><em>Note</em>: If your Unity project already includes one of these libraries (e.g. Json.NET), you may get errors in the Unity Console due to duplicate function/class definitions. In most cases, removing Piglet's copy of the library under <code>Assets/Piglet/Dependencies</code> should solve the issue.</p>

        <h2 id="editor-imports">Editor Imports</h2>

        <p><em>Note</em>: For a video demonstration of Piglet Editor imports, see <a href="https://youtu.be/wf26w0gcVcA">https://youtu.be/wf26w0gcVcA</a>.
            
        <p>Once you have installed Piglet from the Unity Asset Store, you can import glTF models into your Unity project by dragging-and-dropping <code>.gltf</code>/<code>.glb</code>/<code>.zip</code> files from a file browser window (e.g. Windows File Explorer) to a folder inside the Unity Project Browser (Figure 1). Any folder under <code>Assets</code> can be used as the drop target, including the <code>Assets</code> directory itself.</p>

        <p>Importing a glTF file in the Editor produces a Unity prefab for the model, which can then be dragged into your Unity scenes as desired. Piglet places the generated prefab and any dependent asset files (e.g. textures, materials, meshes) under a newly-created subfolder named after the input <code>.gltf</code>/<code>.glb</code>/<code>.zip</code> file.</p>

        <figure>
            <img id="editor-import-figure" src="images/editor-import-figure.png" width="1024" />
            <figcaption>
                Figure 1: Importing a glTF model in the Editor. (A) The user drags-and-drops a .gltf/.glb/.zip file from Windows File Explorer to the Unity Project Browser window. (B) Piglet creates a Unity prefab for the model and opens it in the Prefab View.
            </figcaption>
        </figure>

        <p>There may be circumstances where you want copy a <code>.gltf</code>/<code>.glb</code>/<code>.zip</code> file into your project without automatically converting it to a Unity prefab. You can bypass/disable Piglet's default drag-and-drop behaviour by any of the following methods:</p>

        <ul>
            <li>Hold down the <code>Control</code> or <code>Command</code> key while dragging-and-dropping the <code>.gltf</code>/<code>.glb</code>/<code>.zip</code> into the Unity Project Browser.</li>
            <li>Uncheck <code>Enable drag-and-drop glTF import</code> in the Piglet Options window, located under <code>Window => Piglet Options</code> in the Unity menu. </li>
            <li>Copy the <code>.gltf</code>/<code>.glb</code>/<code>.zip</code> file into the Unity project directory from a file browser window or on the command line. (In other words, copy the file "behind Unity's back".)</li>
        </ul> 

        <h2 id="piglet-options-window">Piglet Options Window</h3>

            <p>A number of options relating Editor imports can be set in the Piglet Options window, located under <code>Window => Piglet Options</code> in the Unity menu.</p>

            <p><img src="images/piglet-options-window.png" /></p>

            <table>
                <tr>
                    <th>Option</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td><code>Enable drag-and-drop glTF import</code></td>
                    <td>Enable/disable automatic glTF imports when dragging .gltf/.glb/.zip files onto the Project Browser window</td>
                </tr>
                <tr>
                    <td><code>Prompt before overwriting files</code></td>
                    <td>Show confirmation prompt if glTF import directory already exists</td>
                </tr>
                <tr>
                    <td><code>Print progress messages in Console</code></td>
                    <td>Log progress messages to Unity Console window during glTF imports (useful for debugging)</td>
                </tr>
                <tr>
                    <td><code>Select prefab in Project Browser</code></td>
                    <td>After a glTF import has completed, select/highlight the generated prefab in the Project Browser window</td>
                </tr>
                <tr>
                    <td><code>Add prefab instance to scene</code></td>
                    <td>After a glTF import has completed, add the generated prefab to the current Unity scene, as a child of the currently selected game object. If no game object is selected in the scene, add the prefab at the root of the scene instead.</td>
                </tr>
                <tr>
                    <td><code>Select prefab instance in scene</code></td>
                    <td>Select/highlight the prefab in the scene hierarchy after adding it to the scene</td>
                </tr>
                <tr>
                    <td><code>Open prefab in Prefab View</code></td>
                    <td>After a glTF import has completed, open the generated prefab in the Prefab View. (This is equivalent to double-clicking the prefab in the Project Browser.)</td>
                </tr>
            </table>

            <h2 id="runtime-imports">Runtime Imports</h2>
            
            <p>Piglet can import a glTF model at runtime from a file path, an HTTP URL, or the raw byte content of a .gltf/.glb/.zip file (<code>byte[]</code>). Runtime imports are performed incrementally, with minimum possible interruption to the main Unity thread.</p>

            <h3 id="runtime-import-tutorial">Runtime Import Tutorial</h3>

            <p>This section walks through example code for importing a glTF model at runtime. The example code presented in this section is included with Piglet under <code>Assets/Piglet/Examples/RuntimeImport</code>, and a video version of this tutorial is available online at <a href="https://youtu.be/f66wmgSTPI0">https://youtu.be/f66wmgSTPI0</a>.</p>

            <p>As our example glTF model, we will use the <code>.glb</code> file for Sir Piggleston (the Piglet mascot), which may be downloaded from <a href="https://awesomesaucelabs.github.io/piglet-webgl-demo/StreamingAssets/piggleston.glb">https://awesomesaucelabs.github.io/piglet-webgl-demo/StreamingAssets/piggleston.glb</a>. The minimal code to import the model at runtime is as follows:</p>

            <figure><pre><code>using Piglet;
using UnityEngine;

/// &lt;summary&gt;
/// This MonoBehaviour provides a minimal example for using
/// Piglet to import glTF models at runtime.
/// &lt;/summary&gt;
public class RuntimeImportBehaviour : MonoBehaviour
{
    /// &lt;summary&gt;
    /// The currently running glTF import task.
    /// &lt;/summary&gt;
    private GltfImportTask _task;

    /// &lt;summary&gt;
    /// Unity callback that is invoked before the first frame.
    /// Create the glTF import task.
    /// &lt;/summary&gt;
    void Start()
    {
        _task = RuntimeGltfImporter.GetImportTask(
             &quot;https://awesomesaucelabs.github.io/piglet-webgl-demo/StreamingAssets/piggleston.glb&quot;);
    }

    /// &lt;summary&gt;
    /// Unity callback that is invoked after every frame.
    /// Here we call MoveNext() to advance execution
    /// of the glTF import task.
    /// &lt;/summary&gt;
    void Update()
    {
        // advance execution of glTF import task
        _task.MoveNext();
    }
}</code></pre>
                <figcaption>Figure 2: Minimal code to import a glTF file at runtime.</figcaption>
            </figure>

            <p>As shown in Figure 2, a runtime glTF import happens in two parts. First, we create an import task by calling <code>RuntimeGltfImporter.GetImportTask</code>, passing in the URL of the glTF model as a parameter. Second, we advance the execution of the import task by repeatedly calling <code>MoveNext()</code> on the task.  A convenient place to call <code>MoveNext()</code> is in the <code>Update()</code> method, which is called by Unity once per frame. Continuing to call <code>MoveNext()</code> after the import has completed does no harm.</p>

            <p>Attaching the script from Figure 2 to any game object in your Unity scene is sufficient to import a glTF model at runtime. However, in a real game/application, you will probably want tighter integration between your own code and the importer. For example, you may want to show progress messages while the model is loading, or to attach custom MonoBehaviours to the model once it has loaded. To achieve these types of behaviours, <code>GltfImportTask</code> provides callback hooks for: progress messages (<code>OnProgress</code>), user cancelation (<code>OnAborted</code>), import errors (<code>OnException</code>), and successful completion (<code>OnCompleted</code>).</p>

            <p>As a first example of callback usage, we'll extend the example script from Figure 2 to print progress messages during the glTF import. We can achieve this by assigning a custom method to the <code>OnProgress</code> callback for the import task, as shown in Figure 3.</p>

            <figure><pre><code>using Piglet;
using UnityEngine;

/// &lt;summary&gt;
/// This MonoBehaviour provides a minimal example for using
/// Piglet to import glTF models at runtime.
/// &lt;/summary&gt;
public class RuntimeImportBehaviour : MonoBehaviour
{
    /// &lt;summary&gt;
    /// The currently running glTF import task.
    /// &lt;/summary&gt;
    private GltfImportTask _task;

    /// &lt;summary&gt;
    /// Unity callback that is invoked before the first frame.
    /// Create the glTF import task.
    /// &lt;/summary&gt;
    void Start()
    {
        _task = RuntimeGltfImporter.GetImportTask(
             &quot;https://awesomesaucelabs.github.io/piglet-webgl-demo/StreamingAssets/piggleston.glb&quot;);
        <strong>_task.OnProgress = OnProgress;</strong>
    }

    <strong>/// &lt;summary&gt;
    /// Callback that is invoked by the glTF import task
    /// to report intermediate progress.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;step&quot;&gt;
    /// The current step of the glTF import process.  Each step imports
    /// a different type of glTF entity (e.g. textures, materials).
    /// &lt;/param&gt;
    /// &lt;param name=&quot;completed&quot;&gt;
    /// The number of glTF entities (e.g. textures, materials) that have been
    /// successfully imported for the current import step.
    /// &lt;/param&gt;
    /// &lt;param name=&quot;total&quot;&gt;
    /// The total number of glTF entities (e.g. textures, materials) that will
    /// be imported for the current import step.
    /// &lt;/param&gt;
    private void OnProgress(ImportStep step, int completed, int total)
    {
        Debug.LogFormat(&quot;{0}: {1}/{2}&quot;, step, completed, total);
    }</strong>

    /// &lt;summary&gt;
    /// Unity callback that is invoked after every frame.
    /// Here we call MoveNext() to advance execution
    /// of the glTF import task.
    /// &lt;/summary&gt;
    void Update()
    {
        // advance execution of glTF import task
        _task.MoveNext();
    }
}</code></pre>
                <figcaption>Figure 3: An extension of the runtime import script from Figure 2 that prints progress messages to the Unity console. New lines are highlighted in bold. </figcaption>
            </figure>

            <p>Another important use of callbacks is to run custom code after a glTF import has successfully completed. For example, you might want to automatically resize the model, parent the model to another game object, or attach a custom <code>MonoBehaviour</code> to the model.  These types of tasks can be accomplished using the <code>OnCompleted</code> callback. To demonstrate, the example script in Figure 4 uses the <code>OnCompleted</code> callback to obtain a reference to the imported model, then uses that reference to continually spin the model about the y-axis as if it were on a record turntable.</p>

            <p>The example in Figure 4 marks the end of this tutorial.  Good luck and happy coding!</p>

            <figure><pre><code>using Piglet;
using UnityEngine;

/// &lt;summary&gt;
/// This MonoBehaviour provides a minimal example for using
/// Piglet to import glTF models at runtime.
/// &lt;/summary&gt;
public class RuntimeImportBehaviour : MonoBehaviour
{
    /// &lt;summary&gt;
    /// The currently running glTF import task.
    /// &lt;/summary&gt;
    private GltfImportTask _task;

    <strong>/// &lt;summary&gt;
    /// Root GameObject of the imported glTF model.
    /// &lt;/summary&gt;
    private GameObject _model;</strong>

    /// &lt;summary&gt;
    /// Unity callback that is invoked before the first frame.
    /// Create the glTF import task.
    /// &lt;/summary&gt;
    void Start()
    {
        _task = RuntimeGltfImporter.GetImportTask(
            &quot;https://awesomesaucelabs.github.io/piglet-webgl-demo/StreamingAssets/piggleston.glb&quot;);
        <strong>_task.OnCompleted = OnComplete;</strong>
    }

    <strong>/// &lt;summary&gt;
    /// Callback that is invoked by the glTF import task
    /// after it has successfully completed.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;importedModel&quot;&gt;
    /// the root GameObject of the imported glTF model
    /// &lt;/param&gt;
    private void OnComplete(GameObject importedModel)
    {
        _model = importedModel;
        Debug.Log(&quot;Success!&quot;);
    }</strong>

    /// &lt;summary&gt;
    /// Unity callback that is invoked after every frame.
    /// Here we call MoveNext() to advance execution
    /// of the glTF import task.
    /// &lt;/summary&gt;
    void Update()
    {
        // advance execution of glTF import task
        _task.MoveNext();

        <strong>// spin model about y-axis
        if (_model != null)
            _model.transform.Rotate(0, 1, 0);</strong>
    }
}</code></pre>
                <figcaption>Figure 4: An extension of the runtime import script from Figure 2 that spins the imported model about the y-axis. New lines are highlighted in bold. </figcaption>
            </figure>

            <h3 id="runtime-import-api">Runtime Import API</h3>

            <p>In Piglet, a runtime glTF import is accomplished by the following steps:</p>

            <ol>
                <li>Create a <code>GltfImportTask</code> by calling <code>RuntimeGltfImporter.GetImportTask</code>, passing in the file path or URL of the input <code>.gltf</code>/<code>.glb</code>/<code>.zip</code> as a parameter.</li>
                <li>Configure callbacks on the <code>GltfImportTask</code> (optional).</li>
                <li>Call <code>MoveNext()</code> on the <code>GltfImportTask</code> until the glTF import has completed.</li>
            </ol>

            <p>For concrete code examples demonstrating the above steps, see the <a href="#runtime-import-tutorial">Runtime Import Tutorial</a>.</p>

            <p><code>RuntimeGltfImporter</code> provides the following methods for creating a <code>GltfImportTask</code>:</p>

            <table>
                <caption>RuntimeGltfImporter Methods</caption>
                <tr>
                    <th>Method</th>
                    <th>Return Type</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td><code>GetImportTask(string uri)</code></td>
                    <td><code>GltfImportTask</code></td>
                    <td>Create an import task that imports the glTF model from <code>uri</code>, where <code>uri</code> is an absolute file path, HTTP(S) URL, or Android content URI that points to a <code>.gltf</code>/<code>.glb</code>/<code>.zip</code> file.</td></tr>
                <tr>
                    <td><code>GetImportTask(Uri uri)</code></td>
                    <td><code>GltfImportTask</code></td>
                    <td>Create an import task that imports the glTF model from <code>uri</code>, where <code>uri</code> is an absolute file path, HTTP(S) URL, or Android content URI that points to a <code>.gltf</code>/<code>.glb</code>/<code>.zip</code> file.</td>
                </tr>
                <tr>
                    <td><code>GetImportTask(byte[] data)</code></td>
                    <td><code>GltfImportTask</code></td>
                    <td>Create an import task that imports from the raw byte content of a <code>.gltf</code>/<code>.glb</code>/<code>.zip</code> file (<code>data</code>).</td>
                </tr>

            </table>

            <p><code>GltfImportTask</code> provides the following methods for controlling its own execution:</p>

            <table>
                <caption>GltfImportTask Methods</caption>
                <tr>
                    <th>Method</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td><code>MoveNext()</code></td>
                    <td>Advance execution of the import task by a small increment. This method should be called repeatedly until the import task has completed.</td>
                </tr>
                <tr>
                    <td><code>Abort()</code></td>
                    <td>Abort the import task. This method should typically be called in response to a user action, such as pressing a "Cancel" button.</td>
                </tr>
            </table>

            <p>In addition, <code>GltfImportTask</code> provides the following callbacks for integrating custom code with the importer:</p>

            <table>
                <caption>GltfImportTask Callbacks</caption>
                <tr>
                    <th>Callback</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td><code>OnProgress</code></td>
                    <td>Invoked at regular intervals to report progress of <code>GltfImportTask</code></td>
                </tr>
                <tr>
                    <td><code>OnAborted</code></td>
                    <td>Invoked when <code>Abort()</code> is called on <code>GltfImportTask</code></td>
                </tr>
                <tr>
                    <td><code>OnException</code></td>
                    <td>Invoked when <code>GltfImportTask</code> throws an exception (e.g. file not found)</td>
                </tr>
                <tr>
                    <td><code>OnCompleted</code></td>
                    <td>Invoked when <code>GltfImportTask</code> completes successfully</td>
                </tr>

            </table>

            <h2 id="piglet-viewer">Sample Application: PigletViewer</h2>

            <figure>
                <img id="webgl-demo-figure" src="images/piglet-webgl-demo.png" width="800" />
                <figcaption>
                    Figure 5: A screenshot of PigletViewer, a sample application which uses Piglet to view 3D models from glTF files.
                </figcaption>
            </figure>

            <p>PigletViewer is sample application which uses Piglet to view 3D models from glTF files (`.gltf`, `.glb`, or `.zip`), and which is used for the <a href="https://awesomesaucelabs.github.io/piglet-webgl-demo/">Piglet Web Demo</a>. For the benefit of Piglet customers, I have published the source code and documentation for PigletViewer online at <a href="https://github.com/AwesomesauceLabs/piglet-viewer">https://github.com/AwesomesauceLabs/piglet-viewer</a>, under an MIT license. PigletViewer currently supports builds for Android, WebGL, and  Windows, and thus it may be a useful reference for Piglet users developing for those platforms. In general, I recommend looking at the <a href="#runtime-import-tutorial">Runtime Import Tutorial</a> before exploring the PigletViewer code, as the tutorial provides a much more succinct introduction to the Piglet API.</p>

            <h2 id="footnotes">Footnotes</h2>
            
            <p id="footnote1">1. As of June 2020, Google Poly only provides glTF download links for models made with <a href="https://arvr.google.com/blocks/">Google Blocks</a> (as opposed to <a href="https://www.tiltbrush.com/">Tilt Brush</a>). To see only Blocks-generated models on Google Poly, visit <a href="https://poly.google.com/blocks">https://poly.google.com/blocks</a>.</p>

            <p id="footnote2">2. I have tested the <a href="https://awesomesaucelabs.github.io/piglet-webgl-demo/">Piglet Web Demo</a> with Firefox and Google Chrome on Windows 10 64-bit. If you are using Google Chrome, you can improve performance of the demo by <a href="https://www.lifewire.com/hardware-acceleration-in-chrome-4125122">turning on hardware acceleration</a> (i.e. GPU acceleration) in the browser settings. Currently this option is disabled in Chrome by default.</p>

    </body>
</html>
